<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description"
    content="Lo stato del sovraffollamento nelle carceri Italiane, aggiornato con gli ultimi dati disponibili del Ministero.">
  <title>Mappa del sovraffollamento carcerario in Italia</title>
  <link rel="icon" href="prison.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <meta content="La mappa del sovraffollamento carcerario in Italia." property="og:site_name">
  <meta name="twitter:creator" content="@mdallastella">
  <meta name="twitter:title" content="La mappa del sovraffollamento carcerario in Italia.">
  <meta name="twitter:description"
    content="Lo stato del sovraffollamento nelle carceri Italiane, aggiornato con gli ultimi dati disponibili del Ministero.">
  <meta name="twitter:image" content="https://marcodallastella.github.io/prison_overcrowding/prison.png">
  <meta name="twitter:image:alt" content="A symbolic image of an overcrowded prison.">
  <meta name="twitter:card" content="summary">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://marcodallastella.github.io/prison_overcrowding/">
  <meta property="og:title" content="La mappa del sovraffollamento carcerario in Italia.">
  <meta property="og:description"
    content="Lo stato del sovraffollamento nelle carceri Italiane, aggiornato con gli ultimi dati disponibili del Ministero.">
  <meta property="og:image" content="https://marcodallastella.github.io/prison_overcrowding/prison.png">
  <meta property="og:image:height" content="912">
  <meta property="og:image:width" content="921">
  <style>
    .hero {
      background-color: rgb(190, 207, 207);
    }

    .iframe-container {
      margin-left: 10%;
      margin-right: 10%;
    }

    .text-container {
      margin-left: 5%;
      margin-right: 5%;
      color: black;
    }

    .is-blank {
      background-color: white;
    }
  </style>
</head>

<body>
  <!-- Hero Section -->
  <section class="hero is-large">
    <div class="hero-body">
      <p class="title">I Numeri del Sovraffollamento Carcerario in Italia.</p>
      <p class="subtitle">Lo stato delle carceri in Italia. Aggiornato con gli ultimi dati disponibili del Ministero.
      </p>
      <p class="subtitle is-6">A cura di <a href="https://marcodallastella.github.io/">Marco Dalla Stella.<a></p>
    </div>
  </section>

  <!-- Main Content Section -->
  <section class="section">
    <section class="hero is-large is-blank">
      <div class="hero-body">
        <div class="text-container is-size-3">
          <p id="last-update" style="display: inline;"></p>
          <p id="detainees-count" style="display: inline;"></p>
          <p id="capacity-count" style="display: inline;"></p>
        </div>
        <br>
        <br>

        <!-- Iframe Container 1 -->
        <div class="iframe-container" id="chart-1">
          <iframe title="Detenuti presenti e Capienza Regolamentare" aria-label="Interactive line chart"
            id="datawrapper-chart-DaecH" src="https://datawrapper.dwcdn.net/DaecH/6/" scrolling="no" frameborder="0"
            style="width: 0; min-width: 100% !important; border: none;" height="435" data-external="1"></iframe>
          <script type="text/javascript">!function () { "use strict"; window.addEventListener("message", (function (a) { if (void 0 !== a.data["datawrapper-height"]) { var e = document.querySelectorAll("iframe"); for (var t in a.data["datawrapper-height"]) for (var r = 0; r < e.length; r++)if (e[r].contentWindow === a.source) { var i = a.data["datawrapper-height"][t] + "px"; e[r].style.height = i } } })) }();
          </script>
        </div>
      </div>
    </section>
    <br>


    <section class="hero is-large is-blank">
      <div class="hero-body">
        <div class="text-container is-size-3">
          <p id="overcrowding-rate" style="display: inline;"></p>
        </div>
      </div>
    </section>
        <br>
        <br>
        <!-- Iframe Container 2 -->
        <section class="hero is-large is-blank">
          <div class="hero-body">

        <div class="iframe-container" id="chart-2">
          <iframe title="Affollamento carcerario in Italia" aria-label="Map" id="datawrapper-chart-LfHlU"
            src="https://datawrapper.dwcdn.net/LfHlU/1/" scrolling="no" frameborder="0"
            style="width: 0; min-width: 100% !important; border: none;" height="731" data-external="1"></iframe>
        </div>
      </div>
    </section>



    <!-- Iframe Container 3 -->
    <div class="iframe-container" id="chart-3">
      <iframe title="I Carceri più sovraffollati d'Italia" aria-label="Tabella" id="datawrapper-chart-iwl9W"
        src="https://datawrapper.dwcdn.net/iwl9W/1/" scrolling="no" frameborder="0"
        style="width: 0; min-width: 100% !important; border: none;" height="1362" data-external="1"></iframe>
    </div>
  </section>

  <script>
    async function fetchData() {
      const response = await fetch('https://raw.githubusercontent.com/marcodallastella/prison_overcrowding/refs/heads/main/outputs/viz/bulletines_totals.csv');
      const data = await response.text();
      const rows = data.split('\n');
      const lastRow = rows[rows.length - 2]; // Get the last data row (excluding empty last line)
      const columns = lastRow.split(',');

      // Get the last update date from the first column
      const lastUpdateDate = columns[0].trim(); // Assuming the first column contains the date

      // Format the date to Italian format
      const formattedDate = new Intl.DateTimeFormat('it-IT', { day: 'numeric', month: 'long', year: 'numeric' }).format(new Date(lastUpdateDate));


      // Assuming the "Detenuti presenti - totale" is the third last column and "Capacità" is the second last column
      const detaineesCount = columns[columns.length - 3].replace(/\./g, '').replace(',', '.'); // Clean the number format
      const numberCount = parseFloat(detaineesCount); // Convert to float

      // Format the detainees count with dot as thousands separator
      const formattedCount = numberCount.toLocaleString('it-IT', { minimumFractionDigits: 0, maximumFractionDigits: 0 }).replace(/,/g, '.');

      // Fetch capacity
      const capacity = columns[columns.length - 4].replace(/\./g, '').replace(',', '.'); // Clean the capacity format
      const formattedCapacity = parseFloat(capacity).toLocaleString('it-IT', { minimumFractionDigits: 0, maximumFractionDigits: 0 }).replace(/,/g, '.');

      // Fetch overcrowding rate
      const overcrowdingRate = columns[columns.length - 1].replace(/\./g, ''); // Adjust column index as necessary
      const formattedRate = parseFloat(overcrowdingRate).toLocaleString('it-IT', { minimumFractionDigits: 0, maximumFractionDigits: 1 });


      // Update the HTML to show the number of detainees and capacity
      document.getElementById('detainees-count').innerText = `${formattedCount}`;
      document.getElementById('capacity-count').innerText = `a fronte di ${formattedCapacity} posti disponibili.`;
      document.getElementById('last-update').innerText = `Al ${formattedDate} i detenuti presenti in Italia erano`; // Display last update date
      document.getElementById('overcrowding-rate').innerText = `Ufficialmente, nelle carceri italiane ci sono quindi ${formattedRate} persone per ogni posto disponibile. Ma la situazione è spesso peggiore, dato che questo dato non tiene conto dei posti che non sono disponibili.`; // Display overcrowding rate


    }

    // Fetch the detainees count and capacity when the page loads
    window.onload = fetchData;


  </script>
</body>

</html>